-- Generated by Oracle SQL Developer Data Modeler 4.2.0.932
--   at:        2017-05-07 22:49:02 CEST
--   site:      Oracle Database 11g
--   type:      Oracle Database 11g

set echo on
CREATE OR REPLACE PROCEDURE "ZRUS_ALL_OBJEKTY_SCHEMATU" AS
-- pokud v logu bude uvedeno, ze nektery objekt nebyl zrusen, protoze na nej jiny jeste existujici objekt stavi,
-- spust proceduru opakovane, dokud se nezrusi vse
v_pom PLS_INTEGER;
BEGIN
LOOP
FOR irec IN (SELECT DISTINCT
                    object_type,object_name,
                    'drop '||object_type||' "'||object_name||'"'||
                    CASE object_type WHEN 'TABLE' THEN ' cascade constraints purge'
                                     ELSE ' '
                    END AS prikaz
              FROM user_objects
              WHERE object_name <> 'ZRUS_ALL_OBJEKTY_SCHEMATU'
            )
  LOOP
   BEGIN
   DBMS_OUTPUT.put_line('prikaz '||irec.prikaz);
      EXECUTE IMMEDIATE irec.prikaz;
   EXCEPTION
      WHEN OTHERS THEN DBMS_OUTPUT.put('nen? ');
   END;
   DBMS_OUTPUT.put_line('zrusen(a) '||irec.object_type||' '||irec.object_name);
  END LOOP;
SELECT COUNT(*) INTO v_pom
FROM user_objects
WHERE object_name <> 'ZRUS_ALL_OBJEKTY_SCHEMATU';
EXIT WHEN v_pom = 0;
END LOOP;
DBMS_OUTPUT.put_line('hotovo!');
END ZRUS_ALL_OBJEKTY_SCHEMATU;
/
execute ZRUS_ALL_OBJEKTY_SCHEMATU











CREATE TABLE typ (
    typ_id           INTEGER NOT NULL,
    popis            VARCHAR2(50 CHAR) NOT NULL
);

ALTER TABLE typ ADD CONSTRAINT typ_pk PRIMARY KEY ( typ_id );


CREATE TABLE uzivatel (
    uzivatel_id           INTEGER NOT NULL,
    jmeno                 VARCHAR2(50 CHAR),
    nickname              VARCHAR2(50 CHAR) NOT NULL,
    email                 VARCHAR2(50 CHAR) NOT NULL,
    typ_id                INTEGER NOT NULL
);

ALTER TABLE uzivatel ADD CONSTRAINT uzivatel_pk PRIMARY KEY ( uzivatel_id );


CREATE TABLE prispevek (
    prispevek_id           INTEGER NOT NULL,
    nadpis                 VARCHAR2(50 CHAR)  ,
    telo                   VARCHAR2(500 CHAR) ,
    uzivatel_id            INTEGER NOT NULL
);

ALTER TABLE prispevek ADD CONSTRAINT prispevek_pk PRIMARY KEY ( prispevek_id );



CREATE TABLE pes (
    pes_id                 INTEGER NOT NULL,
    nadpis                 VARCHAR2(50 CHAR)  ,
    telo                   VARCHAR2(500 CHAR) ,
    uzivatel_id            INTEGER NOT NULL
);

ALTER TABLE pes ADD CONSTRAINT pes_pk PRIMARY KEY ( pes_id );


ALTER TABLE prispevek ADD CONSTRAINT prispevek_uzivatel_fk FOREIGN KEY ( uzivatel_id )
    REFERENCES uzivatel ( uzivatel_id );


ALTER TABLE uzivatel ADD CONSTRAINT uzivatel_typ_fk FOREIGN KEY ( typ_id )
    REFERENCES typ ( typ_id );

